{% extends 'base.html' %}
{% load custom_filters %}

{% block content %}
<div class="container mt-4">
    <h2>Detalhes da Avaliação</h2>
    <div class="card mb-4">
        <div class="card-header">
            Avaliação realizada em {{ avaliacao.data_avaliacao }}
        </div>
        <div class="card-body">
            <p><strong>Colaborador Avaliado:</strong> {{ avaliacao.colaborador_avaliado }}</p>
            <p><strong>Nome Completo:</strong> {{ avaliacao.nome_completo }}</p>
            <p><strong>Cargo Atual:</strong> {{ avaliacao.cargo_atual }}</p>
            <p><strong>Área:</strong> {{ avaliacao.area }}</p>
            <p><strong>Avaliador:</strong> {{ avaliacao.avaliador }}</p>
            <p><strong>Período de Referência:</strong> {{ avaliacao.periodo_referencia }}</p>
            <p><strong>Competências:</strong> {{ avaliacao.competencias }}</p>
            <p><strong>Compromissos:</strong> {{ avaliacao.compromissos }}</p>
            <p><strong>Integração:</strong> {{ avaliacao.integracao }}</p>
            <p><strong>Características:</strong> {{ avaliacao.caracteristicas }}</p>
            <p><strong>Pontos de Melhoria:</strong> {{ avaliacao.pontos_melhoria }}</p>
            <p><strong>PDI:</strong> {{ avaliacao.pdi }}</p>
            <p><strong>Metas:</strong> {{ avaliacao.metas }}</p>
            <p><strong>Alinhamento Semestral:</strong> {{ avaliacao.alinhamento_semestral }}</p>
            <p><strong>Comentários:</strong> {{ avaliacao.comentarios }}</p>
        </div>
    </div>

    <h3>Respostas</h3>
    {% for topico, perguntas in topicos_perguntas.items %}
        <div class="card mb-4">
            <div class="card-header">
                {{ topico.nome }}
            </div>
            <div class="card-body">
                <ul class="list-group mb-4">
                    {% for pergunta in perguntas %}
                        <li class="list-group-item">
                            <strong>Pergunta:</strong> {{ pergunta.texto }}<br>
                            <strong>Resposta:</strong>
                            {% with resposta=respostas|get_item:pergunta.id %}
                                {% if resposta %}
                                    Nota: {{ resposta.nota|default:"N/A" }}<br>
                                {% else %}
                                    N/A
                                {% endif %}
                            {% endwith %}
                        </li>
                    {% endfor %}
                </ul>
                <p><strong>Média das Respostas:</strong> {{ medias_respostas|get_item:topico.id|default:"N/A" }}</p>
            </div>
        </div>
    {% endfor %}
    
    <!-- Debugging output -->
    <h4>Debugging Output</h4>
    <pre>Respostas: {{ respostas|dictsort:"0" }}</pre>
    <pre>Medias Respostas: {{ medias_respostas }}</pre>
</div>
{% endblock %}
